<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - Farmers Mall</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 font-sans">

  <!-- Navbar -->
  <header class="bg-white shadow-sm" id="header">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <!-- Logo -->
      <a href="user-homepage.html" class="flex items-center gap-2 hover:opacity-80 transition">
        <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center">
          <i class="fas fa-leaf text-white text-lg"></i>
        </div>
        <h1 class="text-xl font-bold" style="color: #2E7D32;">Farmers Mall</h1>
      </a>

      <!-- Search -->
      <div class="flex-1 mx-6">
        <form id="searchForm" action="products.html" method="get">
          <input type="text" name="search" id="searchInput" placeholder="Search for fresh produce..."
                 class="w-full px-4 py-2 border rounded-full focus:ring-2 focus:ring-green-500 focus:outline-none">
        </form>
      </div>

      <!-- Icons -->
      <div class="flex items-center space-x-6">
         <a href="user-homepage.html" class="text-gray-600 hover:text-green-600 transition" title="Home"><i class="fa-solid fa-house"></i></a>
        <a href="message.html" class="text-gray-600 hover:text-green-600 transition" title="Messages"><i class="fa-regular fa-comment"></i></a>
        <a href="notification.html" class="text-gray-600 hover:text-green-600 transition" title="Notifications"><i class="fa-regular fa-bell"></i></a>
        <a href="cart.html" class="text-gray-600 hover:text-green-600 transition" title="Cart"><i class="fa-solid fa-cart-shopping"></i></a>
        <a href="profile.html">
          <!-- Active state shown with a ring -->
          <img src="../images/karl.png" alt="User" class="w-8 h-8 rounded-full cursor-pointer ring-2 ring-green-600">
        </a>
      </div>
    </div>
  </header>

  <!-- Main Layout -->
  <main class="max-w-7xl mx-auto px-6 py-10 flex gap-8 mb-96">

    <!-- Sidebar -->
    <aside class="w-72 bg-white rounded-lg shadow p-6">
      <!-- Profile Info -->
      <div class="flex flex-col items-center text-center mb-6">
        <img src="../images/karl.png" class="w-20 h-20 rounded-full mb-3" alt="Profile">
        <h2 class="font-semibold">Piodos De Blanco</h2>
        <p class="text-gray-500 text-sm">PiodosDe.Blanco@email.com</p>
      </div>

      <!-- Navigation -->
      <nav class="space-y-2">
        <a href="#my-profile" class="sidebar-link flex items-center gap-2 px-4 py-2 rounded-lg bg-green-50 text-green-700 font-medium">
          <i class="fas fa-user"></i> My Profile
        </a>
        <a href="#order-history" class="sidebar-link flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100">
          <i class="fas fa-box"></i> Order History
        </a>
        <a href="#my-address" class="sidebar-link flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100">
          <i class="fas fa-map-marker-alt"></i> My Address
        </a>
        <a href="#payment-methods" class="sidebar-link flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100">
          <i class="fas fa-credit-card"></i> Payment Methods
        </a>
        <a href="#settings" class="sidebar-link flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100">
          <i class="fas fa-cog"></i> Settings
        </a>
        <a href="#help-support" class="sidebar-link flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100">
          <i class="fas fa-question-circle"></i> Help & Support
        </a>
        <!-- Logout Button -->
        <div class="border-t pt-2 mt-2">
          <a href="#" id="logoutButton" class="flex items-center gap-2 px-4 py-2 rounded-lg text-red-600 hover:bg-red-50 font-medium">
            <i class="fas fa-sign-out-alt"></i> Logout
          </a>
        </div>
      </nav>
    </aside>

    <!-- Order History Section -->
    <div class="flex-1">
      <!-- My Profile Section -->
      <section id="my-profile" class="content-section bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="font-semibold text-lg">My Profile</h2>
          <button id="editProfileBtn" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
            <i class="fas fa-pen"></i> Edit Profile
          </button>
        </div>

        <!-- Profile Display Mode -->
        <div id="profileDisplay" class="space-y-6">
          <!-- Profile Picture & Basic Info -->
          <div class="flex items-start gap-6 pb-6 border-b">
            <div class="relative">
              <img id="displayProfilePic" src="../images/karl.png" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-green-100">
              <div class="absolute bottom-0 right-0 w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white border-4 border-white">
                <i class="fas fa-camera text-sm"></i>
              </div>
            </div>
            <div class="flex-1">
              <h3 id="displayFullName" class="text-2xl font-bold text-gray-800 mb-1">Piodos De Blanco</h3>
              <p id="displayEmail" class="text-gray-600 mb-3">PiodosDe.Blanco@email.com</p>
              <p id="displayBio" class="text-gray-600 text-sm italic">Passionate about fresh, organic produce and supporting local farmers.</p>
            </div>
          </div>

          <!-- Personal Information Grid -->
          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-gray-50 p-4 rounded-lg">
              <label class="text-xs text-gray-500 uppercase tracking-wide">Phone Number</label>
              <p id="displayPhone" class="text-gray-800 font-medium mt-1">+63 912 345 6789</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <label class="text-xs text-gray-500 uppercase tracking-wide">Date of Birth</label>
              <p id="displayDob" class="text-gray-800 font-medium mt-1">January 15, 1990</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <label class="text-xs text-gray-500 uppercase tracking-wide">Gender</label>
              <p id="displayGender" class="text-gray-800 font-medium mt-1">Male</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <label class="text-xs text-gray-500 uppercase tracking-wide">Member Since</label>
              <p id="displayMemberSince" class="text-gray-800 font-medium mt-1">March 2024</p>
            </div>
          </div>

          <!-- Account Statistics -->
          <div class="pt-6 border-t">
            <h4 class="font-semibold mb-4 text-gray-700">Account Statistics</h4>
            <div class="grid grid-cols-3 gap-4">
              <div class="text-center p-4 bg-green-50 rounded-lg">
                <p class="text-2xl font-bold text-green-600">24</p>
                <p class="text-sm text-gray-600 mt-1">Total Orders</p>
              </div>
              <div class="text-center p-4 bg-blue-50 rounded-lg">
                <p class="text-2xl font-bold text-blue-600">₱12,450</p>
                <p class="text-sm text-gray-600 mt-1">Total Spent</p>
              </div>
              <div class="text-center p-4 bg-purple-50 rounded-lg">
                <p class="text-2xl font-bold text-purple-600">5</p>
                <p class="text-sm text-gray-600 mt-1">Saved Items</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Edit Mode (Hidden by default) -->
        <form id="profileEditForm" class="space-y-6 hidden">
          <!-- Profile Picture Upload -->
          <div class="flex items-start gap-6 pb-6 border-b">
            <div class="relative">
              <img id="editProfilePicPreview" src="../images/karl.png" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-green-100">
              <label for="profilePicInput" class="absolute bottom-0 right-0 w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white border-4 border-white cursor-pointer hover:bg-green-700 transition">
                <i class="fas fa-camera text-sm"></i>
              </label>
              <input type="file" id="profilePicInput" accept="image/*" class="hidden">
            </div>
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-700 mb-2">Profile Picture</label>
              <p class="text-sm text-gray-500 mb-2">Click the camera icon to upload a new profile picture</p>
              <button type="button" id="removeProfilePic" class="text-sm text-red-600 hover:text-red-700">
                <i class="fas fa-trash-alt mr-1"></i> Remove Picture
              </button>
            </div>
          </div>

          <!-- Personal Information -->
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
              <input type="text" id="editFullName" required class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
              <input type="email" id="editEmail" required class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
              <input type="tel" id="editPhone" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="+63">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
              <input type="date" id="editDob" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
              <select id="editGender" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none">
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
                <option value="Prefer not to say">Prefer not to say</option>
              </select>
            </div>
          </div>

          <!-- Bio -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
            <textarea id="editBio" rows="3" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Tell us about yourself..."></textarea>
          </div>

          <!-- Action Buttons -->
          <div class="flex justify-end gap-3 pt-4 border-t">
            <button type="button" id="cancelEditProfile" class="px-6 py-2 border rounded-lg text-sm font-medium hover:bg-gray-50">
              Cancel
            </button>
            <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700">
              <i class="fas fa-save mr-1"></i> Save Changes
            </button>
          </div>
        </form>
      </section>

      <section id="order-history" class="content-section bg-white rounded-lg shadow p-6 hidden">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
          <h2 class="font-semibold text-lg">Order History</h2>
          <div class="flex items-center gap-3">
            <select class="border rounded-lg px-3 py-2 text-sm">
              <option>Last 3 months</option>
              <option>Last 6 months</option>
              <option>Last year</option>
            </select>
            <button class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>

        <!-- Order List Container -->
        <div id="orderList" class="space-y-4">
          <!-- Orders will be dynamically inserted here -->
          <div id="noOrdersPlaceholder" class="text-center text-gray-500 py-10 border-2 border-dashed rounded-lg">
            <i class="fas fa-receipt text-3xl mb-3"></i>
            <p>You haven't placed any orders yet.</p>
            <a href="products.php" class="mt-4 inline-block bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
              Start Shopping
            </a>
          </div>
        </div>
      </section>

      <!-- Saved Addresses Section (Hidden by default) -->
      <section id="my-address" class="content-section bg-white rounded-lg shadow p-6 hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="font-semibold text-lg">My Delivery Address</h2>
            <button id="editAddressBtn" class="border px-4 py-2 rounded-lg text-sm hover:bg-gray-100">
              <i class="fas fa-pen mr-1"></i> Edit
            </button>
        </div>
        <div id="addressDisplay" class="text-gray-600 leading-relaxed">
          <!-- Address will be dynamically inserted here -->
          <div id="noAddressPlaceholder" class="text-center text-gray-500 py-10 border-2 border-dashed rounded-lg">
            <i class="fas fa-map-marker-alt text-3xl mb-3"></i>
            <p>No saved addresses yet.</p>
          </div>
        </div>
      </section>

      <!-- Payment Methods Section (Hidden by default) -->
      <section id="payment-methods" class="content-section bg-white rounded-lg shadow p-6 hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="font-semibold text-lg">Payment Methods</h2>
          <button id="addPaymentBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
            <i class="fas fa-plus mr-1"></i> Add New Card
          </button>
        </div>
        <div id="paymentList" class="space-y-4">
          <!-- Payment methods will be dynamically inserted here -->
          <div id="noPaymentPlaceholder" class="text-center text-gray-500 py-10">
            <i class="fas fa-credit-card text-3xl mb-3"></i>
            <p>No payment methods saved.</p>
          </div>
        </div>
      </section>

      <!-- Settings Section (Hidden by default) -->
      <section id="settings" class="content-section bg-white rounded-lg shadow p-6 hidden">
        <h2 class="font-semibold text-lg mb-6">Settings</h2>
        <div class="space-y-6">
          <div>
            <h3 class="font-medium text-md mb-3">Email Notifications</h3>
            <div class="space-y-3">
              <label class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="font-medium text-sm">Order Updates</p>
                  <p class="text-xs text-gray-500">Receive updates on your order status.</p>
                </div>
                <input type="checkbox" class="toggle-switch" data-setting="orderUpdates" checked>
              </label>
              <label class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="font-medium text-sm">Promotions & News</p>
                  <p class="text-xs text-gray-500">Get notified about sales and new products.</p>
                </div>
                <input type="checkbox" class="toggle-switch" data-setting="promotions" checked>
              </label>
            </div>
          </div>
        </div>
      </section>

      <!-- Help & Support Section (Hidden by default) -->
      <section id="help-support" class="content-section bg-white rounded-lg shadow p-6 hidden">
        <h2 class="font-semibold text-lg mb-6">Help & Support</h2>
        <div class="space-y-3" id="faqAccordion">
          <!-- FAQ Item 1 -->
          <div class="border rounded-lg">
            <button class="faq-question w-full text-left p-4 flex justify-between items-center font-medium">
              <span>How do I track my order?</span>
              <i class="fas fa-chevron-down transition-transform"></i>
            </button>
            <div class="faq-answer hidden p-4 border-t text-sm text-gray-600">
              You can track your order from the "Order History" section. Click on "Track Order" for any item that is in transit.
            </div>
          </div>
          <!-- FAQ Item 2 -->
          <div class="border rounded-lg">
            <button class="faq-question w-full text-left p-4 flex justify-between items-center font-medium">
              <span>What is your return policy?</span>
              <i class="fas fa-chevron-down transition-transform"></i>
            </button>
            <div class="faq-answer hidden p-4 border-t text-sm text-gray-600">
              Due to the nature of fresh produce, we only accept returns for damaged or incorrect items reported within 24 hours of delivery. Please contact our support team with a photo of the issue.
            </div>
          </div>
          <!-- FAQ Item 3 -->
          <div class="border rounded-lg">
            <button class="faq-question w-full text-left p-4 flex justify-between items-center font-medium">
              <span>How do I change my delivery address?</span>
              <i class="fas fa-chevron-down transition-transform"></i>
            </button>
            <div class="faq-answer hidden p-4 border-t text-sm text-gray-600">
              You can manage your delivery locations in the "Saved Addresses" section. You can add, edit, or delete addresses there.
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="text-white py-12" style="background-color: #1B5E20;">
    <div class="max-w-6xl mx-auto px-6 grid md:grid-cols-4 gap-8">
      
      <!-- Logo/About -->
      <div>
        <h3 class="font-bold text-lg mb-3">Farmers Mall</h3>
        <p class="text-gray-300 text-sm">
          Fresh, organic produce delivered straight to your home from local farmers.
        </p>
      </div>
      
      <!-- Quick Links -->
      <div>
        <h3 class="font-bold text-lg mb-3">Quick Links</h3>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="#" class="hover:underline">About Us</a></li>
          <li><a href="#" class="hover:underline">Contact</a></li>
          <li><a href="#" class="hover:underline">FAQ</a></li>
          <li><a href="#" class="hover:underline">Support</a></li>
        </ul>
      </div>

      <!-- Categories -->
      <div>
        <h3 class="font-bold text-lg mb-3">Categories</h3>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="#" class="hover:underline">Vegetables</a></li>
          <li><a href="#" class="hover:underline">Fruits</a></li>
          <li><a href="#" class="hover:underline">Dairy</a></li>
          <li><a href="#" class="hover:underline">Meat</a></li>
        </ul>
      </div>

      <!-- Social -->
      <div>
        <h3 class="font-bold text-lg mb-3">Follow Us</h3>
        <div class="flex space-x-4 text-xl">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>

    <!-- Divider -->
    <div class="border-t border-green-800 text-center text-gray-400 text-sm mt-10 pt-6">
      © 2025 Farmers Mall. All rights reserved.
    </div>
  </footer>

  <!-- Add Address Modal -->
  <div id="addressModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
      <h3 class="font-semibold text-lg mb-4">Add New Address</h3>
      <form id="addressForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Full Name</label>
          <input type="text" id="address-name" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Street Address</label>
          <input type="text" id="address-street" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-gray-700">City</label><input type="text" id="address-city" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none"></div>
          <div><label class="block text-sm font-medium text-gray-700">Province</label><input type="text" id="address-province" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none"></div>
        </div>
        <div class="mt-6 flex justify-end gap-3">
          <button type="button" class="modal-close px-4 py-2 border rounded-md text-sm">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md text-sm">Save Address</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Payment Modal -->
  <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
      <h3 class="font-semibold text-lg mb-4">Add New Card</h3>
      <form id="paymentForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Card Number</label>
          <input type="text" id="card-number" placeholder="•••• •••• •••• ••••" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Cardholder Name</label>
          <input type="text" id="card-name" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div><label class="block text-sm font-medium text-gray-700">Expiry (MM/YY)</label><input type="text" id="card-expiry" placeholder="MM/YY" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none"></div>
          <div><label class="block text-sm font-medium text-gray-700">CVV</label><input type="text" id="card-cvv" placeholder="•••" required class="mt-1 w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-green-500 outline-none"></div>
        </div>
        <div class="mt-6 flex justify-end gap-3">
          <button type="button" class="modal-close px-4 py-2 border rounded-md text-sm">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md text-sm">Save Card</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-sm text-center">
      <div class="text-red-500 text-4xl mb-4"><i class="fa-solid fa-triangle-exclamation"></i></div>
      <h3 class="font-semibold text-lg mb-2">Confirm Logout</h3>
      <p class="text-gray-600 text-sm mb-6">Are you sure you want to log out?</p>
      <div class="flex justify-center gap-4">
        <button id="cancelLogout" class="px-6 py-2 border rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100">Cancel</button>
        <a href="../auth/logout.php" id="confirmLogout" class="px-6 py-2 bg-red-600 text-white rounded-md text-sm font-medium hover:bg-red-700">Logout</a>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const sidebarLinks = document.querySelectorAll('.sidebar-link');
      const contentSections = document.querySelectorAll('.content-section');

      function updateContent(hash) {
        // Default to my-profile if hash is empty or invalid
        const targetHash = hash || '#my-profile';
        
        // Hide all sections
        contentSections.forEach(section => {
          section.classList.add('hidden');
        });

        // Show the target section
        const targetSection = document.querySelector(targetHash);
        if (targetSection) {
          targetSection.classList.remove('hidden');
        }

        // Update active link style
        sidebarLinks.forEach(link => {
          if (link.getAttribute('href') === targetHash) {
            link.classList.add('bg-green-50', 'text-green-700', 'font-medium');
            link.classList.remove('hover:bg-gray-100');
          } else {
            link.classList.remove('bg-green-50', 'text-green-700', 'font-medium');
            link.classList.add('hover:bg-gray-100');
          }
        });
      }

      // Handle clicks on sidebar links
      sidebarLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault(); // Prevent the page from jumping
          updateContent(link.hash);
        });
      });

      // Show content based on initial URL hash, or default to the first one
      updateContent(window.location.hash);

      // --- Modal Management ---
      const addressModal = document.getElementById('addressModal');
      const paymentModal = document.getElementById('paymentModal');
      const editAddressBtn = document.getElementById('editAddressBtn');
      const addPaymentBtn = document.getElementById('addPaymentBtn');
      const closeModalBtns = document.querySelectorAll('.modal-close');

      const openModal = (modal) => modal.classList.remove('hidden');
      const closeModal = (modal) => modal.classList.add('hidden');

      editAddressBtn.addEventListener('click', () => openModal(addressModal));
      addPaymentBtn.addEventListener('click', () => openModal(paymentModal));
      closeModalBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          closeModal(addressModal);
          closeModal(paymentModal);
        });
      });

      // --- Saved Addresses Logic ---
      const addressForm = document.getElementById('addressForm');
      const addressDisplay = document.getElementById('addressDisplay');
      const noAddressPlaceholder = document.getElementById('noAddressPlaceholder');
      let userAddress = JSON.parse(localStorage.getItem('userAddress')) || null;

      function renderAddress() {
        addressDisplay.innerHTML = ''; // Clear current content
        if (!userAddress || !userAddress.name) {
          addressDisplay.appendChild(noAddressPlaceholder);
          noAddressPlaceholder.style.display = 'block';
        } else {
          noAddressPlaceholder.style.display = 'none';
          addressDisplay.innerHTML = `
            <p class="font-medium">${userAddress.name}</p>
            <p>${userAddress.street}</p>
            <p>${userAddress.city}, ${userAddress.province}</p>
          `;
        }
        // Pre-fill the modal form when it's opened
        document.getElementById('address-name').value = userAddress?.name || '';
        document.getElementById('address-street').value = userAddress?.street || '';
        document.getElementById('address-city').value = userAddress?.city || '';
        document.getElementById('address-province').value = userAddress?.province || '';
      }

      addressForm.addEventListener('submit', (e) => {
        e.preventDefault();
        userAddress = {
          name: document.getElementById('address-name').value,
          street: document.getElementById('address-street').value,
          city: document.getElementById('address-city').value,
          province: document.getElementById('address-province').value,
        };
        localStorage.setItem('userAddress', JSON.stringify(userAddress));
        renderAddress();
        addressForm.reset();
        closeModal(addressModal);
      });

      // --- Payment Methods Logic ---
      const paymentForm = document.getElementById('paymentForm');
      const paymentList = document.getElementById('paymentList');
      const noPaymentPlaceholder = document.getElementById('noPaymentPlaceholder');
      let payments = JSON.parse(localStorage.getItem('userPayments')) || [];

      function getCardType(number) {
        if (/^4/.test(number)) return { type: 'Visa', icon: 'fa-cc-visa', color: 'text-blue-700' };
        if (/^5[1-5]/.test(number)) return { type: 'Mastercard', icon: 'fa-cc-mastercard', color: 'text-red-600' };
        return { type: 'Card', icon: 'fa-credit-card', color: 'text-gray-500' };
      }

      function renderPayments() {
        paymentList.innerHTML = '';
        if (payments.length === 0) {
          paymentList.appendChild(noPaymentPlaceholder);
          noPaymentPlaceholder.style.display = 'block';
        } else {
          noPaymentPlaceholder.style.display = 'none';
          payments.forEach((pay, index) => {
            const cardInfo = getCardType(pay.number);
            const div = document.createElement('div');
            div.className = 'p-4 border rounded-lg flex justify-between items-center';
            div.innerHTML = `
              <div class="flex items-center gap-3">
                <i class="fab ${cardInfo.icon} ${cardInfo.color} text-2xl"></i>
                <div>
                  <p class="font-medium">${cardInfo.type} ending in ${pay.number.slice(-4)}</p>
                  <p class="text-sm text-gray-500">Expires ${pay.expiry}</p>
                </div>
              </div>
              <button class="delete-payment-btn text-red-500 hover:text-red-700 text-sm" data-index="${index}"><i class="fas fa-trash"></i></button>
            `;
            paymentList.appendChild(div);
          });
        }
      }

      paymentForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const newPayment = {
          number: document.getElementById('card-number').value,
          name: document.getElementById('card-name').value,
          expiry: document.getElementById('card-expiry').value,
        };
        payments.push(newPayment);
        localStorage.setItem('userPayments', JSON.stringify(payments));
        renderPayments();
        paymentForm.reset();
        closeModal(paymentModal);
      });

      paymentList.addEventListener('click', (e) => {
        if (e.target.closest('.delete-payment-btn')) {
          const index = e.target.closest('.delete-payment-btn').dataset.index;
          payments.splice(index, 1);
          localStorage.setItem('userPayments', JSON.stringify(payments));
          renderPayments();
        }
      });

      // --- Settings Logic ---
      const toggleSwitches = document.querySelectorAll('.toggle-switch');
      let userSettings = JSON.parse(localStorage.getItem('userSettings')) || { orderUpdates: true, promotions: true };

      function applySettings() {
        toggleSwitches.forEach(toggle => {
          const settingName = toggle.dataset.setting;
          toggle.checked = userSettings[settingName] !== false; // Default to true if not set
        });
      }

      toggleSwitches.forEach(toggle => {
        toggle.addEventListener('change', () => {
          const settingName = toggle.dataset.setting;
          userSettings[settingName] = toggle.checked;
          localStorage.setItem('userSettings', JSON.stringify(userSettings));
        });
      });

      // --- FAQ Accordion Logic ---
      const faqQuestions = document.querySelectorAll('.faq-question');
      faqQuestions.forEach(question => {
        question.addEventListener('click', () => {
          const answer = question.nextElementSibling;
          const icon = question.querySelector('i');
          
          answer.classList.toggle('hidden');
          icon.classList.toggle('rotate-180');
        });
      });

      // --- Order History Logic ---
      const orderList = document.getElementById('orderList');
      const noOrdersPlaceholder = document.getElementById('noOrdersPlaceholder');
      let userOrders = JSON.parse(localStorage.getItem('userOrders')) || [];

      function getStatusInfo(status) {
        switch (status) {
          case 'Delivered': return { text: 'Delivered', class: 'text-green-600' };
          case 'Shipped': return { text: 'In Transit', class: 'text-blue-600' };
          case 'Cancelled': return { text: 'Cancelled', class: 'text-red-600' };
          default: return { text: 'Pending', class: 'text-orange-500' };
        }
      }

      function renderOrders() {
        orderList.innerHTML = '';
        if (userOrders.length === 0) {
          orderList.appendChild(noOrdersPlaceholder);
          noOrdersPlaceholder.style.display = 'block';
        } else {
          noOrdersPlaceholder.style.display = 'none';
          // Sort by most recent first
          userOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
          
          userOrders.forEach(order => {
            const statusInfo = getStatusInfo(order.status);
            const firstItem = order.items[0];
            const additionalItems = order.items.length - 1;
            const itemSummary = `${firstItem.name}${additionalItems > 0 ? ` + ${additionalItems} more item(s)` : ''}`;

            const div = document.createElement('div');
            div.className = 'flex items-center justify-between border-b pb-4';
            div.innerHTML = `
              <div class="flex items-center gap-4">
                <img src="${firstItem.image}" alt="${firstItem.name}" class="rounded-lg w-16 h-16 object-cover">
                <div>
                  <h3 class="font-medium">Order ${order.id}</h3>
                  <p class="text-sm text-gray-500">Placed on ${new Date(order.timestamp).toLocaleDateString()}</p>
                  <p class="text-sm">${itemSummary}</p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-semibold">₱${order.total.toFixed(2)}</p>
                <span class="${statusInfo.class} text-xs font-medium">${statusInfo.text}</span>
                <div class="text-sm mt-1">
                  <a href="#" class="text-green-600 hover:underline">View Details</a>
                  ${order.status === 'Delivered' ? `· <a href="#" class="text-green-600 hover:underline">Reorder</a>` : ''}
                  ${order.status === 'Shipped' ? `· <a href="#" class="text-green-600 hover:underline">Track</a>` : ''}
                </div>
              </div>
            `;
            orderList.appendChild(div);
          });
        }
      }

      // --- Initial Render on Load ---
      renderOrders();
      renderAddress();
      renderPayments();
      applySettings();

      // --- Profile Edit Logic ---
      const editProfileBtn = document.getElementById('editProfileBtn');
      const cancelEditProfile = document.getElementById('cancelEditProfile');
      const profileDisplay = document.getElementById('profileDisplay');
      const profileEditForm = document.getElementById('profileEditForm');
      const profilePicInput = document.getElementById('profilePicInput');
      const editProfilePicPreview = document.getElementById('editProfilePicPreview');
      const removeProfilePic = document.getElementById('removeProfilePic');

      // Load user profile from localStorage or use defaults
      let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {
        fullName: 'Piodos De Blanco',
        email: 'PiodosDe.Blanco@email.com',
        phone: '+63 912 345 6789',
        dob: '1990-01-15',
        gender: 'Male',
        bio: 'Passionate about fresh, organic produce and supporting local farmers.',
        profilePic: '../images/karl.png',
        memberSince: 'March 2024'
      };

      function renderProfile() {
        // Update display mode
        document.getElementById('displayProfilePic').src = userProfile.profilePic;
        document.getElementById('displayFullName').textContent = userProfile.fullName;
        document.getElementById('displayEmail').textContent = userProfile.email;
        document.getElementById('displayPhone').textContent = userProfile.phone || 'Not provided';
        document.getElementById('displayDob').textContent = userProfile.dob ? new Date(userProfile.dob).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Not provided';
        document.getElementById('displayGender').textContent = userProfile.gender || 'Not specified';
        document.getElementById('displayBio').textContent = userProfile.bio || 'No bio added yet.';
        document.getElementById('displayMemberSince').textContent = userProfile.memberSince;

        // Update sidebar profile info
        document.querySelector('aside img').src = userProfile.profilePic;
        document.querySelector('aside h2').textContent = userProfile.fullName;
        document.querySelector('aside p').textContent = userProfile.email;

        // Update navbar profile pic
        document.querySelector('header img[alt="User"]').src = userProfile.profilePic;

        // Pre-fill edit form
        document.getElementById('editFullName').value = userProfile.fullName;
        document.getElementById('editEmail').value = userProfile.email;
        document.getElementById('editPhone').value = userProfile.phone || '';
        document.getElementById('editDob').value = userProfile.dob || '';
        document.getElementById('editGender').value = userProfile.gender || '';
        document.getElementById('editBio').value = userProfile.bio || '';
        editProfilePicPreview.src = userProfile.profilePic;
      }

      // Switch to edit mode
      editProfileBtn.addEventListener('click', () => {
        profileDisplay.classList.add('hidden');
        profileEditForm.classList.remove('hidden');
        editProfileBtn.classList.add('hidden');
      });

      // Cancel editing
      cancelEditProfile.addEventListener('click', () => {
        profileDisplay.classList.remove('hidden');
        profileEditForm.classList.add('hidden');
        editProfileBtn.classList.remove('hidden');
        renderProfile(); // Reset form to current values
      });

      // Handle profile picture upload
      profilePicInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            editProfilePicPreview.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      // Remove profile picture
      removeProfilePic.addEventListener('click', () => {
        editProfilePicPreview.src = '../images/karl.png';
        profilePicInput.value = '';
      });

      // Save profile changes
      profileEditForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Update profile data
        userProfile.fullName = document.getElementById('editFullName').value;
        userProfile.email = document.getElementById('editEmail').value;
        userProfile.phone = document.getElementById('editPhone').value;
        userProfile.dob = document.getElementById('editDob').value;
        userProfile.gender = document.getElementById('editGender').value;
        userProfile.bio = document.getElementById('editBio').value;
        userProfile.profilePic = editProfilePicPreview.src;

        // Save to localStorage
        localStorage.setItem('userProfile', JSON.stringify(userProfile));

        // Dispatch custom event for other tabs/windows to listen
        window.dispatchEvent(new Event('storage'));
        
        // Dispatch event for same page listeners
        window.dispatchEvent(new CustomEvent('profileUpdated', { detail: userProfile }));

        // Update display
        renderProfile();

        // Switch back to display mode
        profileDisplay.classList.remove('hidden');
        profileEditForm.classList.add('hidden');
        editProfileBtn.classList.remove('hidden');

        // Show success message
        alert('Profile updated successfully! Your changes will be reflected across all pages.');
      });

      // Initial render
      renderProfile();

      // --- Logout Modal Logic ---
      const logoutButton = document.getElementById('logoutButton');
      const logoutModal = document.getElementById('logoutModal');
      const cancelLogoutBtn = document.getElementById('cancelLogout');
  
      if (logoutButton && logoutModal && cancelLogoutBtn) {
        logoutButton.addEventListener('click', (e) => {
          e.preventDefault(); // Prevent the link from navigating immediately
          logoutModal.classList.remove('hidden');
        });
  
        cancelLogoutBtn.addEventListener('click', () => {
          logoutModal.classList.add('hidden');
        });
  
        // Also close modal if user clicks on the background overlay
        logoutModal.addEventListener('click', (e) => {
          if (e.target === logoutModal) logoutModal.classList.add('hidden');
        });
      }

      // --- Search Functionality ---
      const searchForm = document.getElementById('searchForm');
      const searchInput = document.getElementById('searchInput');

      if (searchForm && searchInput) {
        searchForm.addEventListener('submit', (e) => {
          const searchTerm = searchInput.value.trim();
          if (searchTerm) {
            // Redirect to products page with search query
            window.location.href = `products.html?search=${encodeURIComponent(searchTerm)}`;
          }
          e.preventDefault();
        });

        // Also trigger search on Enter key
        searchInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            searchForm.dispatchEvent(new Event('submit'));
          }
        });
      }
    });
  </script>
</body>
</html>
